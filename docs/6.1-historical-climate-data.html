<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="6.1 Historical climate data | An introduction to NAPdown" />
<meta property="og:type" content="book" />
<meta property="og:url" content="https://napdown.github.io/NAPdown/" />

<meta property="og:description" content="<p>This is an introduction to NAPdown.Chapter1 introduces you to the basics
of R and RStudio, Chapter2 introduces napdown, a bookdown concept and Chapter3
on sharing and collaboration with GitHub. The subsequent chapters go into detail
about working with different types of data and data sources.
Additional chapters are provided further reading material and references.</p>" />
<meta name="github-repo" content="napdown/NAPdown" />

<meta name="author" content="A Team" />

<meta name="date" content="2021-10-19" />


<meta name="description" content="<p>This is an introduction to NAPdown.Chapter1 introduces you to the basics
of R and RStudio, Chapter2 introduces napdown, a bookdown concept and Chapter3
on sharing and collaboration with GitHub. The subsequent chapters go into detail
about working with different types of data and data sources.
Additional chapters are provided further reading material and references.</p>">

<title>6.1 Historical climate data | An introduction to NAPdown</title>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-jqueryui-1.10.20/css/dataTables.jqueryui.min.css" rel="stylesheet" />
<script src="libs/dt-core-jqueryui-1.10.20/js/jquery.dataTables.min.js"></script>
<script src="libs/dt-core-jqueryui-1.10.20/js/dataTables.jqueryui.min.js"></script>
<script src="libs/jszip-1.10.20/jszip.min.js"></script>
<script src="libs/pdfmake-1.10.20/pdfmake.js"></script>
<script src="libs/pdfmake-1.10.20/vfs_fonts.js"></script>
<link href="libs/dt-ext-buttons-jqueryui-1.10.20/css/buttons.jqueryui.min.css" rel="stylesheet" />
<script src="libs/dt-ext-buttons-jqueryui-1.10.20/js/dataTables.buttons.min.js"></script>
<script src="libs/dt-ext-buttons-jqueryui-1.10.20/js/buttons.flash.min.js"></script>
<script src="libs/dt-ext-buttons-jqueryui-1.10.20/js/buttons.html5.min.js"></script>
<script src="libs/dt-ext-buttons-jqueryui-1.10.20/js/buttons.colVis.min.js"></script>
<script src="libs/dt-ext-buttons-jqueryui-1.10.20/js/buttons.print.min.js"></script>
<script src="libs/dt-ext-buttons-jqueryui-1.10.20/js/buttons.jqueryui.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#prerequisites"><span class="toc-section-number">1</span> Prerequisites</a>
<ul>
<li><a href="1.1-opening-a-markdown-file.html#opening-a-markdown-file"><span class="toc-section-number">1.1</span> Opening a markdown file</a>
<ul>
<li><a href="1.1-opening-a-markdown-file.html#rstudio-windows-explained"><span class="toc-section-number">1.1.1</span> Rstudio windows explained:</a></li>
</ul></li>
<li><a href="1.2-installing-packages.html#installing-packages"><span class="toc-section-number">1.2</span> Installing packages</a>
<ul>
<li><a href="1.2-installing-packages.html#removingun-installing-packages"><span class="toc-section-number">1.2.1</span> Removing/un-installing packages</a></li>
</ul></li>
<li><a href="1.3-loading-libraries.html#loading-libraries"><span class="toc-section-number">1.3</span> Loading Libraries</a></li>
</ul></li>
<li><a href="2-getting-started.html#getting-started"><span class="toc-section-number">2</span> Getting started</a>
<ul>
<li><a href="2.1-about-rmarkdown.html#about-rmarkdown"><span class="toc-section-number">2.1</span> About RMarkdown</a></li>
<li><a href="2.2-editing-in-markdown.html#editing-in-markdown"><span class="toc-section-number">2.2</span> Editing in markdown</a>
<ul>
<li><a href="2.2-editing-in-markdown.html#headers"><span class="toc-section-number">2.2.1</span> Headers</a></li>
<li><a href="2.2-editing-in-markdown.html#bold-and-italic-text"><span class="toc-section-number">2.2.2</span> Bold and italic text</a></li>
<li><a href="2.2-editing-in-markdown.html#create-lists"><span class="toc-section-number">2.2.3</span> Create Lists</a></li>
<li><a href="2.2-editing-in-markdown.html#manual-line-breaks"><span class="toc-section-number">2.2.4</span> Manual line breaks</a></li>
<li><a href="2.2-editing-in-markdown.html#insert-links"><span class="toc-section-number">2.2.5</span> Insert links</a></li>
<li><a href="2.2-editing-in-markdown.html#insert-figuresimages"><span class="toc-section-number">2.2.6</span> Insert figures/images</a></li>
<li><a href="2.2-editing-in-markdown.html#insert-block-quotes"><span class="toc-section-number">2.2.7</span> Insert block quotes</a></li>
<li><a href="2.2-editing-in-markdown.html#insert-code-chunks"><span class="toc-section-number">2.2.8</span> Insert code chunks</a></li>
<li><a href="2.2-editing-in-markdown.html#create-tables"><span class="toc-section-number">2.2.9</span> Create tables</a></li>
<li><a href="2.2-editing-in-markdown.html#page-breaks"><span class="toc-section-number">2.2.10</span> Page breaks</a></li>
<li><a href="2.2-editing-in-markdown.html#process-a-markdown-document-to-desired-output"><span class="toc-section-number">2.2.11</span> Process a markdown document to desired output</a></li>
<li><a href="2.2-editing-in-markdown.html#references"><span class="toc-section-number">2.2.12</span> References</a></li>
<li><a href="2.2-editing-in-markdown.html#pandoc-knitr"><span class="toc-section-number">2.2.13</span> Pandoc &amp; Knitr</a></li>
</ul></li>
</ul></li>
<li><a href="3-napdown.html#napdown"><span class="toc-section-number">3</span> NAPdown</a>
<ul>
<li><a href="3.1-setting-up-an-enap.html#setting-up-an-enap"><span class="toc-section-number">3.1</span> Setting up an eNAP</a></li>
<li><a href="3.2-integrating-code-evaluations-within-your-text-chapters.html#integrating-code-evaluations-within-your-text-chapters"><span class="toc-section-number">3.2</span> Integrating code evaluations within your text/ chapters</a>
<ul>
<li><a href="3.2-integrating-code-evaluations-within-your-text-chapters.html#some-things-to-note"><span class="toc-section-number">3.2.1</span> Some things to note</a></li>
</ul></li>
<li><a href="3.3-some-troubleshooting.html#some-troubleshooting"><span class="toc-section-number">3.3</span> Some Troubleshooting</a></li>
</ul></li>
<li><a href="4-github-github-pages.html#github-github-pages"><span class="toc-section-number">4</span> GitHub &amp; GitHub Pages</a>
<ul>
<li><a href="4.1-sharing-repositories-on-github.html#sharing-repositories-on-github"><span class="toc-section-number">4.1</span> Sharing Repositories on GitHub</a>
<ul>
<li><a href="4.1-sharing-repositories-on-github.html#via-github-desktop"><span class="toc-section-number">4.1.1</span> Via GitHub Desktop</a></li>
<li><a href="4.1-sharing-repositories-on-github.html#via-direct-file-upload"><span class="toc-section-number">4.1.2</span> Via direct file upload</a></li>
<li><a href="4.1-sharing-repositories-on-github.html#via-git-bash"><span class="toc-section-number">4.1.3</span> Via Git Bash</a></li>
</ul></li>
<li><a href="4.2-publishing-to-github-pages.html#publishing-to-github-pages"><span class="toc-section-number">4.2</span> Publishing to GitHub pages</a></li>
</ul></li>
<li><a href="5-working-excel-data.html#working-excel-data"><span class="toc-section-number">5</span> Working Excel data</a>
<ul>
<li><a href="5.1-prep.html#prep"><span class="toc-section-number">5.1</span> Prep</a>
<ul>
<li><a href="5.1-prep.html#install-packages"><span class="toc-section-number">5.1.1</span> Install packages</a></li>
<li><a href="5.1-prep.html#call-libraries-for-the-installed-packages"><span class="toc-section-number">5.1.2</span> Call libraries for the installed packages</a></li>
<li><a href="5.1-prep.html#import-excel-table-from-local-drive"><span class="toc-section-number">5.1.3</span> Import excel table from local drive</a></li>
</ul></li>
<li><a href="5.2-build-tables.html#build-tables"><span class="toc-section-number">5.2</span> Build Tables</a>
<ul>
<li><a href="5.2-build-tables.html#static-table"><span class="toc-section-number">5.2.1</span> Static table</a></li>
<li><a href="5.2-build-tables.html#interactive-table"><span class="toc-section-number">5.2.2</span> Interactive table</a></li>
</ul></li>
<li><a href="5.3-generate-other-graphics.html#generate-other-graphics"><span class="toc-section-number">5.3</span> Generate Other Graphics</a>
<ul>
<li><a href="5.3-generate-other-graphics.html#a-bar-chart"><span class="toc-section-number">5.3.1</span> A bar chart</a></li>
<li><a href="5.3-generate-other-graphics.html#a-donut-chart"><span class="toc-section-number">5.3.2</span> A donut chart</a></li>
</ul></li>
<li><a href="5.4-filter-and-plot-select-data.html#filter-and-plot-select-data"><span class="toc-section-number">5.4</span> Filter and plot select data</a>
<ul>
<li><a href="5.4-filter-and-plot-select-data.html#pie-chart"><span class="toc-section-number">5.4.1</span> Pie chart</a></li>
<li><a href="5.4-filter-and-plot-select-data.html#build-treemap"><span class="toc-section-number">5.4.2</span> Build Treemap</a></li>
</ul></li>
</ul></li>
<li><a href="6-working-climate-data.html#working-climate-data"><span class="toc-section-number">6</span> Working Climate data</a>
<ul>
<li><a href="6.1-historical-climate-data.html#historical-climate-data"><span class="toc-section-number">6.1</span> Historical climate data</a>
<ul>
<li><a href="6.1-historical-climate-data.html#install-packages-and-load-libraries"><span class="toc-section-number">6.1.1</span> Install Packages and load libraries</a></li>
<li><a href="6.1-historical-climate-data.html#load-data-from-cru-website"><span class="toc-section-number">6.1.2</span> Load data from cru website</a></li>
<li><a href="6.1-historical-climate-data.html#loaddefine-geometry"><span class="toc-section-number">6.1.3</span> Load/define geometry</a></li>
<li><a href="6.1-historical-climate-data.html#loadimport-your-data-into-r"><span class="toc-section-number">6.1.4</span> Load/Import your data into r</a></li>
<li><a href="6.1-historical-climate-data.html#convert-the-raster-stack-created-above-into-a-dataframe-and-format-date-values"><span class="toc-section-number">6.1.5</span> Convert the raster stack created above into a dataframe and format date values</a></li>
<li><a href="6.1-historical-climate-data.html#plot-monthly-data"><span class="toc-section-number">6.1.6</span> Plot Monthly data</a></li>
<li><a href="6.1-historical-climate-data.html#plot-annual-data"><span class="toc-section-number">6.1.7</span> Plot Annual data</a></li>
</ul></li>
</ul></li>
<li><a href="7-further-reads.html#further-reads"><span class="toc-section-number">7</span> Further Reads</a></li>
<li><a href="references-1.html#references-1">References</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="historical-climate-data" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Historical climate data</h2>
<div id="install-packages-and-load-libraries" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Install Packages and load libraries</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="6.1-historical-climate-data.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;R.utils&quot;,&quot;rnaturalearth&quot;,&quot;reshape&quot;,&quot;raster&quot;,&quot;magrittr&quot;,&quot;dplyr&quot;,&quot;lubridate&quot;)</span></span>
<span id="cb14-2"><a href="6.1-historical-climate-data.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R.utils)</span>
<span id="cb14-3"><a href="6.1-historical-climate-data.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb14-4"><a href="6.1-historical-climate-data.html#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape)</span>
<span id="cb14-5"><a href="6.1-historical-climate-data.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb14-6"><a href="6.1-historical-climate-data.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb14-7"><a href="6.1-historical-climate-data.html#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-8"><a href="6.1-historical-climate-data.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
</div>
<div id="load-data-from-cru-website" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Load data from cru website</h3>
<ol style="list-style-type: decimal">
<li>On your browser, navigate to (<a href="https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.05/cruts.2103051243.v4.05/" class="uri">https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.05/cruts.2103051243.v4.05/</a>). This is where all data variables are stored.</li>
<li>Select the variable of your choice. In the example below, we will use precipitation and mean temperature data, variable names ‘pre’ &amp; ‘tmp’ respectively.</li>
<li>On the data folder, find data for the years 1901-2020(cru_ts4.05.1901.2020.pre.dat.nc.gz/ru_ts4.05.1901.2020.tmp.dat.nc.gz).</li>
<li>Right click on it and copy link address. Open a code chunk and paste your link in an object( as in ‘myurl’ in below code).</li>
<li>Call the function <code>download.file</code> and enter details as below.</li>
<li>The files are stored as a compressed .gz file; to extract the files, call the function <code>gunzip</code> and enter file name with the .gz extension</li>
<li>Run code</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="6.1-historical-climate-data.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pre</span></span>
<span id="cb15-2"><a href="6.1-historical-climate-data.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#preurl&lt;- &quot;https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.05/cruts.2103051243.v4.05/pre/cru_ts4.05.1901.2020.pre.dat.nc.gz&quot;</span></span>
<span id="cb15-3"><a href="6.1-historical-climate-data.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#download.file(preurl, destfile=&quot;cru_ts4.05.1901.2020.pre.dat.nc.gz&quot;)</span></span>
<span id="cb15-4"><a href="6.1-historical-climate-data.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#gunzip(&quot;cru_ts4.05.1901.2020.pre.dat.nc.gz&quot;)</span></span>
<span id="cb15-5"><a href="6.1-historical-climate-data.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="6.1-historical-climate-data.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp</span></span>
<span id="cb15-7"><a href="6.1-historical-climate-data.html#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#tmpurl&lt;- &quot;https://crudata.uea.ac.uk/cru/data/hrg/cru_ts_4.05/cruts.2103051243.v4.05/tmp/cru_ts4.05.1901.2020.tmp.dat.nc.gz&quot;</span></span>
<span id="cb15-8"><a href="6.1-historical-climate-data.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#download.file(tmpurl, destfile=&quot;cru_ts4.05.1901.2020.tmp.dat.nc.gz&quot;)</span></span>
<span id="cb15-9"><a href="6.1-historical-climate-data.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#gunzip(&quot;cru_ts4.05.1901.2020.tmp.dat.nc.gz&quot;)</span></span></code></pre></div>
</div>
<div id="loaddefine-geometry" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Load/define geometry</h3>
<p>This is where data to define your area of interest goes.
You may upload your own geometry,such as shapefile or use any of the map services available in r. In this case we will use country boundaries from the package <code>rnaturalearth</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="6.1-historical-climate-data.html#cb16-1" aria-hidden="true" tabindex="-1"></a>malawi<span class="ot">&lt;-</span>rnaturalearth<span class="sc">::</span><span class="fu">ne_countries</span>(<span class="at">country =</span><span class="st">&#39;malawi&#39;</span>)</span></code></pre></div>
</div>
<div id="loadimport-your-data-into-r" class="section level3" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Load/Import your data into r</h3>
<p>Create new object name and call the raster function <code>stack</code>
Enter the path to your data directory/ where you saved the downloaded file.
To extract data exactly to your polygon shape, use the raster functions <code>crop</code> and <code>mask</code> and the bounding geometry (in our case the Malawi national boundary)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="6.1-historical-climate-data.html#cb17-1" aria-hidden="true" tabindex="-1"></a>prstack<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">Esther Makabe</span><span class="sc">\\</span><span class="st">NAPdown</span><span class="sc">\\</span><span class="st">cru_ts4.05.1901.2020.pre.dat.nc&quot;</span>)</span>
<span id="cb17-2"><a href="6.1-historical-climate-data.html#cb17-2" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span><span class="fu">stack</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">Esther Makabe</span><span class="sc">\\</span><span class="st">NAPdown</span><span class="sc">\\</span><span class="st">cru_ts4.05.1901.2020.tmp.dat.nc&quot;</span>)</span>
<span id="cb17-3"><a href="6.1-historical-climate-data.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="6.1-historical-climate-data.html#cb17-4" aria-hidden="true" tabindex="-1"></a>pr_crop<span class="ot">&lt;-</span>raster<span class="sc">::</span><span class="fu">crop</span>(prstack, malawi) <span class="co"># cut out data for malawi</span></span>
<span id="cb17-5"><a href="6.1-historical-climate-data.html#cb17-5" aria-hidden="true" tabindex="-1"></a>pr_mask<span class="ot">&lt;-</span>raster<span class="sc">::</span><span class="fu">mask</span>(pr_crop,malawi) <span class="co"># mask data to malawi boundary</span></span>
<span id="cb17-6"><a href="6.1-historical-climate-data.html#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="6.1-historical-climate-data.html#cb17-7" aria-hidden="true" tabindex="-1"></a>tcrop<span class="ot">&lt;-</span>raster<span class="sc">::</span><span class="fu">crop</span>(temp, malawi)</span>
<span id="cb17-8"><a href="6.1-historical-climate-data.html#cb17-8" aria-hidden="true" tabindex="-1"></a>tmask<span class="ot">&lt;-</span>raster<span class="sc">::</span><span class="fu">mask</span>(tcrop, malawi)</span></code></pre></div>
<p>At this point you can already plot individual precipitation and temperature layers using the basic plot function. Below we plot precipitation and temperature for October 2011</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="6.1-historical-climate-data.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb18-2"><a href="6.1-historical-climate-data.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prstack<span class="sc">$</span>X2011.<span class="fl">10.16</span>, <span class="at">main=</span><span class="st">&#39;Precipitation&#39;</span>)</span>
<span id="cb18-3"><a href="6.1-historical-climate-data.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp<span class="sc">$</span>X2011.<span class="fl">10.16</span>, <span class="at">main=</span><span class="st">&#39;Temperature&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="convert-the-raster-stack-created-above-into-a-dataframe-and-format-date-values" class="section level3" number="6.1.5">
<h3><span class="header-section-number">6.1.5</span> Convert the raster stack created above into a dataframe and format date values</h3>
<p>This step extracts raster values at each station (depicted by its latitude and longitude) and stores them as a table.<br />
The <code>melt</code> function converts the data from a wide to long table format.<br />
The date values in our data are stored as and within text and the step below is to extract the dates from this text and store them in a new column.<br />
We also, create two more columns to separate Year and Month</p>
<p><strong>Caution!: The process in this code chunk involves modifying the data and data structure and thus extra attention is required. If you need to run the code or part of it more than once, it is strongly recommended to run the whole code chunk rather than in parts.This is to avoid duplication and conflict in executing commands.</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="6.1-historical-climate-data.html#cb19-1" aria-hidden="true" tabindex="-1"></a>prdf<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(pr_mask, <span class="at">xy=</span><span class="cn">TRUE</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span><span class="fu">melt</span>(<span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">&#39;x&#39;</span>,<span class="st">&#39;y&#39;</span>)) <span class="co"># create dataframe</span></span>
<span id="cb19-2"><a href="6.1-historical-climate-data.html#cb19-2" aria-hidden="true" tabindex="-1"></a>tmpdf<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(tmask, <span class="at">xy=</span><span class="cn">TRUE</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span><span class="fu">melt</span>(<span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>))</span>
<span id="cb19-3"><a href="6.1-historical-climate-data.html#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="6.1-historical-climate-data.html#cb19-4" aria-hidden="true" tabindex="-1"></a>Date<span class="ot">&lt;-</span><span class="fu">substr</span>(prdf<span class="sc">$</span>variable, <span class="dv">2</span>,<span class="dv">11</span>) <span class="co"># extract date values from the dataframe</span></span>
<span id="cb19-5"><a href="6.1-historical-climate-data.html#cb19-5" aria-hidden="true" tabindex="-1"></a>prdf<span class="sc">$</span>Date<span class="ot">&lt;-</span>Date <span class="co"># add date column to dataframe</span></span>
<span id="cb19-6"><a href="6.1-historical-climate-data.html#cb19-6" aria-hidden="true" tabindex="-1"></a>Year<span class="ot">&lt;-</span><span class="fu">substr</span>(Date,<span class="dv">1</span>,<span class="dv">4</span>)</span>
<span id="cb19-7"><a href="6.1-historical-climate-data.html#cb19-7" aria-hidden="true" tabindex="-1"></a>Month<span class="ot">&lt;-</span><span class="fu">substr</span>(Date,<span class="dv">6</span>,<span class="dv">7</span>)</span>
<span id="cb19-8"><a href="6.1-historical-climate-data.html#cb19-8" aria-hidden="true" tabindex="-1"></a>prdf<span class="ot">&lt;-</span><span class="fu">cbind</span>(prdf, Year, Month)</span>
<span id="cb19-9"><a href="6.1-historical-climate-data.html#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="6.1-historical-climate-data.html#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(prdf)[<span class="fu">colnames</span>(prdf)<span class="sc">==</span><span class="st">&quot;value&quot;</span>]<span class="ot">&lt;-</span><span class="st">&quot;pr&quot;</span>  <span class="co"># change column label</span></span>
<span id="cb19-11"><a href="6.1-historical-climate-data.html#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="6.1-historical-climate-data.html#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="6.1-historical-climate-data.html#cb19-13" aria-hidden="true" tabindex="-1"></a>tmpdf<span class="sc">$</span>Date<span class="ot">&lt;-</span><span class="fu">substr</span>(tmpdf<span class="sc">$</span>variable, <span class="dv">2</span>,<span class="dv">11</span>) </span>
<span id="cb19-14"><a href="6.1-historical-climate-data.html#cb19-14" aria-hidden="true" tabindex="-1"></a>tmpdf<span class="sc">$</span>Year<span class="ot">&lt;-</span><span class="fu">substr</span>(tmpdf<span class="sc">$</span>Date,<span class="dv">1</span>,<span class="dv">4</span>)</span>
<span id="cb19-15"><a href="6.1-historical-climate-data.html#cb19-15" aria-hidden="true" tabindex="-1"></a>tmpdf<span class="sc">$</span>Month<span class="ot">&lt;-</span><span class="fu">substr</span>(tmpdf<span class="sc">$</span>Date,<span class="dv">6</span>,<span class="dv">7</span>)</span>
<span id="cb19-16"><a href="6.1-historical-climate-data.html#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="6.1-historical-climate-data.html#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmpdf)[<span class="fu">colnames</span>(tmpdf)<span class="sc">==</span><span class="st">&quot;value&quot;</span>]<span class="ot">&lt;-</span><span class="st">&quot;tmean&quot;</span> </span></code></pre></div>
</div>
<div id="plot-monthly-data" class="section level3" number="6.1.6">
<h3><span class="header-section-number">6.1.6</span> Plot Monthly data</h3>
<p>Our data is now ready for some statistical analysis.
we may plot monthly data as below;</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="6.1-historical-climate-data.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarise data by month and calculate monthly mean</span></span>
<span id="cb20-2"><a href="6.1-historical-climate-data.html#cb20-2" aria-hidden="true" tabindex="-1"></a>pr_monthly<span class="ot">&lt;-</span>prdf<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(Year<span class="sc">&gt;=</span><span class="dv">1981</span>)<span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Month)<span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="6.1-historical-climate-data.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;pr&quot;</span>), <span class="sc">~</span><span class="fu">mean</span>(pr))) </span>
<span id="cb20-4"><a href="6.1-historical-climate-data.html#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="6.1-historical-climate-data.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange drawing order to plot from July to June</span></span>
<span id="cb20-6"><a href="6.1-historical-climate-data.html#cb20-6" aria-hidden="true" tabindex="-1"></a>pr_monthly<span class="sc">$</span>Month<span class="ot">&lt;-</span><span class="fu">factor</span>(pr_monthly<span class="sc">$</span>Month,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;07&#39;</span>,<span class="st">&#39;08&#39;</span>,<span class="st">&#39;09&#39;</span>,<span class="st">&#39;10&#39;</span>,<span class="st">&#39;11&#39;</span>,<span class="st">&#39;12&#39;</span>,<span class="st">&#39;01&#39;</span>,<span class="st">&#39;02&#39;</span>,<span class="st">&#39;03&#39;</span>,<span class="st">&#39;04&#39;</span>,<span class="st">&#39;05&#39;</span>,<span class="st">&#39;06&#39;</span>))</span>
<span id="cb20-7"><a href="6.1-historical-climate-data.html#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="6.1-historical-climate-data.html#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="6.1-historical-climate-data.html#cb20-9" aria-hidden="true" tabindex="-1"></a>temp_monthly<span class="ot">&lt;-</span>tmpdf<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(Year<span class="sc">&gt;=</span><span class="dv">1981</span>)<span class="sc">%&gt;%</span><span class="fu">group_by</span>(Month)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="st">&#39;tmean&#39;</span><span class="ot">=</span><span class="fu">mean</span>(tmean))</span>
<span id="cb20-10"><a href="6.1-historical-climate-data.html#cb20-10" aria-hidden="true" tabindex="-1"></a>temp_monthly<span class="sc">$</span>Month<span class="ot">&lt;-</span><span class="fu">factor</span>(temp_monthly<span class="sc">$</span>Month, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;07&#39;</span>,<span class="st">&#39;08&#39;</span>,<span class="st">&#39;09&#39;</span>,<span class="st">&#39;10&#39;</span>,<span class="st">&#39;11&#39;</span>,<span class="st">&#39;12&#39;</span>,<span class="st">&#39;01&#39;</span>,<span class="st">&#39;02&#39;</span>,<span class="st">&#39;03&#39;</span>,<span class="st">&#39;04&#39;</span>,<span class="st">&#39;05&#39;</span>,<span class="st">&#39;06&#39;</span>))</span>
<span id="cb20-11"><a href="6.1-historical-climate-data.html#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="6.1-historical-climate-data.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the pr and temp data frames </span></span>
<span id="cb20-13"><a href="6.1-historical-climate-data.html#cb20-13" aria-hidden="true" tabindex="-1"></a>pr_tmp<span class="ot">&lt;-</span><span class="fu">cbind</span>(pr_monthly,temp_monthly) </span>
<span id="cb20-14"><a href="6.1-historical-climate-data.html#cb20-14" aria-hidden="true" tabindex="-1"></a>pr_tmp<span class="ot">&lt;-</span>pr_tmp[,<span class="sc">-</span><span class="dv">3</span>] <span class="co"># remove duplicate column</span></span>
<span id="cb20-15"><a href="6.1-historical-climate-data.html#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="6.1-historical-climate-data.html#cb20-16" aria-hidden="true" tabindex="-1"></a>pr_tmp<span class="sc">$</span>Month<span class="ot">&lt;-</span>month.abb</span>
<span id="cb20-17"><a href="6.1-historical-climate-data.html#cb20-17" aria-hidden="true" tabindex="-1"></a>pr_tmp<span class="sc">$</span>Month<span class="ot">&lt;-</span><span class="fu">factor</span>(pr_tmp<span class="sc">$</span>Month, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Sep&quot;</span> ,<span class="st">&quot;Oct&quot;</span> ,<span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dec&quot;</span>, <span class="st">&quot;Jan&quot;</span> ,<span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;Apr&quot;</span> ,<span class="st">&quot;May&quot;</span> ,<span class="st">&quot;Jun&quot;</span>))</span>
<span id="cb20-18"><a href="6.1-historical-climate-data.html#cb20-18" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-19"><a href="6.1-historical-climate-data.html#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># define properties for secondary axis (only when plotting 2 variables in the same plot area)</span></span>
<span id="cb20-20"><a href="6.1-historical-climate-data.html#cb20-20" aria-hidden="true" tabindex="-1"></a>ty<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">overlaying =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb20-21"><a href="6.1-historical-climate-data.html#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">side =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb20-22"><a href="6.1-historical-climate-data.html#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Temperature (°C)&quot;</span>,</span>
<span id="cb20-23"><a href="6.1-historical-climate-data.html#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">autotick =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-24"><a href="6.1-historical-climate-data.html#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">8</span>,</span>
<span id="cb20-25"><a href="6.1-historical-climate-data.html#cb20-25" aria-hidden="true" tabindex="-1"></a> <span class="at">range=</span><span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">30</span>)</span>
<span id="cb20-26"><a href="6.1-historical-climate-data.html#cb20-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-27"><a href="6.1-historical-climate-data.html#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="6.1-historical-climate-data.html#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb20-29"><a href="6.1-historical-climate-data.html#cb20-29" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">plot_ly</span>(<span class="at">type=</span> <span class="st">&#39;bar&#39;</span>, <span class="at">data=</span> pr_tmp, <span class="at">x=</span> <span class="sc">~</span>Month, <span class="at">y=</span> <span class="sc">~</span>pr, <span class="at">name =</span> <span class="st">&#39;Precipitation&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb20-30"><a href="6.1-historical-climate-data.html#cb20-30" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">add_lines</span>(<span class="at">x=</span> <span class="sc">~</span>Month, <span class="at">y=</span> <span class="sc">~</span>tmean,<span class="at">name=</span> <span class="st">&#39;Temperature&#39;</span>, <span class="at">yaxis=</span><span class="st">&#39;y2&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb20-31"><a href="6.1-historical-climate-data.html#cb20-31" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">add_markers</span>(<span class="at">x=</span> <span class="sc">~</span>Month, <span class="at">y=</span> <span class="sc">~</span>tmean,<span class="at">color=</span><span class="st">&#39;#D21919&#39;</span>, <span class="at">yaxis=</span><span class="st">&#39;y2&#39;</span>, <span class="at">name=</span><span class="st">&#39;Temperature&#39;</span>, <span class="at">showlegend=</span><span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb20-32"><a href="6.1-historical-climate-data.html#cb20-32" aria-hidden="true" tabindex="-1"></a>    plotly<span class="sc">::</span><span class="fu">layout</span>(<span class="at">legend=</span><span class="fu">list</span>(<span class="at">orientation=</span><span class="st">&#39;h&#39;</span>, <span class="at">y=</span><span class="sc">-</span><span class="fl">0.13</span>,<span class="at">x=</span><span class="fl">0.65</span>), <span class="at">yaxis=</span><span class="fu">list</span>(<span class="at">title=</span><span class="st">&#39;Precipitation (mm)&#39;</span>,<span class="at">showticklables=</span>F),<span class="at">width=</span><span class="dv">700</span>, <span class="at">height=</span><span class="dv">450</span>, <span class="at">title=</span><span class="st">&#39;Malawi </span><span class="sc">\n</span><span class="st"> (Mean 1981-2020)&#39;</span>, <span class="at">yaxis2=</span>ty)<span class="sc">%&gt;%</span></span>
<span id="cb20-33"><a href="6.1-historical-climate-data.html#cb20-33" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">subplot</span>(<span class="at">titleX =</span> <span class="cn">TRUE</span>, <span class="at">titleY =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div id="htmlwidget-e22826c4f5138cd219e4" style="width:700px;height:450px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e22826c4f5138cd219e4">{"x":{"data":[{"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[236.186323629154,203.404239620765,187.385419570075,85.192918188663,23.6017365073164,7.09770844770182,6.18743067150418,3.00090282604409,2.44861115033014,16.6350697480297,65.1021538800663,196.752364269892],"name":"Precipitation","type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","Jun"],"y":[18.4629170583354,19.9084031879902,22.5202781412337,24.5893753581577,25.3703475952148,24.5015281571282,23.773055934906,23.6645142409537,23.5943753653102,22.5336114923159,20.803472606341,19.1088892704911],"name":"Temperature","type":"scatter","mode":"lines","yaxis":"y2","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","frame":null},{"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[23.773055934906,23.6645142409537,23.5943753653102,22.5336114923159,20.803472606341,19.1088892704911,18.4629170583354,19.9084031879902,22.5202781412337,24.5893753581577,25.3703475952148,24.5015281571282],"name":"Temperature","type":"scatter","mode":"markers","yaxis":"y2","showlegend":false,"marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"title":"Month","type":"category","categoryorder":"array","categoryarray":["Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","Jun"],"anchor":"y"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Precipitation (mm)","showticklables":false,"anchor":"x"},"yaxis2":{"overlaying":"y","side":"right","title":"Temperature (°C)","autotick":false,"dtick":8,"range":[15,30],"anchor":"x","domain":[0,1]},"annotations":[],"shapes":[],"images":[],"width":700,"height":450,"margin":{"b":40,"l":60,"t":25,"r":10},"legend":{"orientation":"h","y":-0.13,"x":0.65},"title":"Malawi <br /> (Mean 1981-2020)","hovermode":"closest","showlegend":true},"attrs":{"74c19c837e5":{"x":{},"y":{},"name":"Precipitation","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"74c19c837e5.1":{"x":{},"y":{},"name":"Temperature","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","yaxis":"y2","inherit":true},"74c19c837e5.2":{"x":{},"y":{},"name":"Temperature","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"markers","color":"#D21919","yaxis":"y2","showlegend":false,"inherit":true}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="plot-annual-data" class="section level3" number="6.1.7">
<h3><span class="header-section-number">6.1.7</span> Plot Annual data</h3>
<p>or the annual means as below;</p>
<ul>
<li>Subset the data to get only values from 1981 on wards (or whichever year is preferred)</li>
<li>Then, group the data by years</li>
<li>Calculate mean values for each year</li>
<li>Combine the data frames</li>
<li>Plot time series object</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="6.1-historical-climate-data.html#cb21-1" aria-hidden="true" tabindex="-1"></a>pr_ann<span class="ot">&lt;-</span>prdf<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(Year<span class="sc">&gt;=</span><span class="dv">1981</span>)<span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Year)<span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="6.1-historical-climate-data.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;pr&quot;</span>), <span class="sc">~</span><span class="fu">mean</span>(pr))) </span>
<span id="cb21-3"><a href="6.1-historical-climate-data.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="6.1-historical-climate-data.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="6.1-historical-climate-data.html#cb21-5" aria-hidden="true" tabindex="-1"></a>temp_ann<span class="ot">&lt;-</span>tmpdf<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(Year<span class="sc">&gt;=</span><span class="dv">1981</span>)<span class="sc">%&gt;%</span><span class="fu">group_by</span>(Year)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="st">&#39;tmean&#39;</span><span class="ot">=</span><span class="fu">mean</span>(tmean))</span>
<span id="cb21-6"><a href="6.1-historical-climate-data.html#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="6.1-historical-climate-data.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the pr and temp data frames</span></span>
<span id="cb21-8"><a href="6.1-historical-climate-data.html#cb21-8" aria-hidden="true" tabindex="-1"></a>pr.tmp<span class="ot">&lt;-</span><span class="fu">cbind</span>(pr_ann,temp_ann) </span>
<span id="cb21-9"><a href="6.1-historical-climate-data.html#cb21-9" aria-hidden="true" tabindex="-1"></a>pr.tmp<span class="ot">&lt;-</span>pr.tmp[,<span class="sc">-</span><span class="dv">3</span>] <span class="co"># remove duplicate column</span></span>
<span id="cb21-10"><a href="6.1-historical-climate-data.html#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="6.1-historical-climate-data.html#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># define properties for secondary axis</span></span>
<span id="cb21-12"><a href="6.1-historical-climate-data.html#cb21-12" aria-hidden="true" tabindex="-1"></a>ty<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">overlaying =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb21-13"><a href="6.1-historical-climate-data.html#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">side =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb21-14"><a href="6.1-historical-climate-data.html#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Temperature (°C)&quot;</span>,</span>
<span id="cb21-15"><a href="6.1-historical-climate-data.html#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">autotick =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-16"><a href="6.1-historical-climate-data.html#cb21-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">10</span>,</span>
<span id="cb21-17"><a href="6.1-historical-climate-data.html#cb21-17" aria-hidden="true" tabindex="-1"></a> <span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30</span>)</span>
<span id="cb21-18"><a href="6.1-historical-climate-data.html#cb21-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-19"><a href="6.1-historical-climate-data.html#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="6.1-historical-climate-data.html#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb21-21"><a href="6.1-historical-climate-data.html#cb21-21" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">plot_ly</span>(<span class="at">type=</span> <span class="st">&#39;bar&#39;</span>, <span class="at">data=</span> pr.tmp, <span class="at">x=</span> <span class="sc">~</span>Year, <span class="at">y=</span> <span class="sc">~</span>pr, <span class="at">name =</span> <span class="st">&#39;Precipitation&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-22"><a href="6.1-historical-climate-data.html#cb21-22" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">add_lines</span>(<span class="at">x=</span> <span class="sc">~</span>Year, <span class="at">y=</span> <span class="sc">~</span>tmean, <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>,<span class="at">name=</span> <span class="st">&#39;Temperature&#39;</span>, <span class="at">yaxis=</span><span class="st">&#39;y2&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-23"><a href="6.1-historical-climate-data.html#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plotly::add_markers(x= ~Month, y= ~tmean, pch=1,color=&#39;#D21919&#39;, yaxis=&#39;y2&#39;, name=&#39;&#39;)%&gt;%</span></span>
<span id="cb21-24"><a href="6.1-historical-climate-data.html#cb21-24" aria-hidden="true" tabindex="-1"></a>    plotly<span class="sc">::</span><span class="fu">layout</span>(<span class="at">legend=</span><span class="fu">list</span>(<span class="at">orientation=</span><span class="st">&#39;h&#39;</span>, <span class="at">y=</span><span class="sc">-</span><span class="fl">0.13</span>,<span class="at">x=</span><span class="fl">0.7</span>), <span class="at">yaxis=</span><span class="fu">list</span>(<span class="at">title=</span><span class="st">&#39;Precipitation (mm)&#39;</span>,<span class="at">showticklables=</span>F),<span class="at">width=</span><span class="dv">700</span>, <span class="at">height=</span><span class="dv">450</span>, <span class="at">title=</span><span class="st">&#39;Malawi </span><span class="sc">\n</span><span class="st"> (Mean 1981-2020)&#39;</span>, <span class="at">yaxis2=</span>ty, <span class="at">xaxis=</span><span class="fu">list</span>(<span class="at">tickangle=</span><span class="dv">270</span>))</span></code></pre></div>
<div id="htmlwidget-f32d6c0b69582c298470" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-f32d6c0b69582c298470">{"x":{"visdat":{"74c5ce06068":["function () ","plotlyVisDat"]},"cur_data":"74c5ce06068","attrs":{"74c5ce06068":{"x":{},"y":{},"name":"Precipitation","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"74c5ce06068.1":{"x":{},"y":{},"name":"Temperature","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","yaxis":"y2","inherit":true}},"layout":{"width":700,"height":450,"margin":{"b":40,"l":60,"t":25,"r":10},"legend":{"orientation":"h","y":-0.13,"x":0.7},"yaxis":{"domain":[0,1],"automargin":true,"title":"Precipitation (mm)","showticklables":false},"title":"Malawi <br /> (Mean 1981-2020)","yaxis2":{"overlaying":"y","side":"right","title":"Temperature (°C)","autotick":false,"dtick":10,"range":[0,30]},"xaxis":{"domain":[0,1],"automargin":true,"tickangle":270,"title":"Year","type":"category","categoryorder":"array","categoryarray":["1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020"],"y":[78.8673623211302,97.534029458339,75.7962975702076,93.770835158967,100.607640587794,100.127085064158,69.8009271127758,92.5236126391597,114.618751737893,68.2511585336006,87.3143533248523,59.5270843510861,78.9319456837106,66.4048622610496,76.2606496312311,91.9504646690631,98.007640773327,70.3266214679892,98.430326104578,93.2157423902062,94.8092609767423,80.5280106913436,82.0750012953973,94.082640471851,71.701390121753,79.6196774371589,89.127316414827,88.5393532659789,90.4715290740132,76.0469920877712,93.3456030312615,82.0173622765923,85.8282422682063,80.7585662808442,75.770603045528,79.0678254804505,93.876390134519,95.8932887683795,114.606251768871,82.8835659658674],"name":"Precipitation","type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020"],"y":[21.6731484929721,21.8351855785758,22.8138892628528,22.0597226178205,21.7370374004046,21.7930559184816,22.5312503863264,22.1789355719531,21.7125003536542,22.3057874242465,22.0930559591011,22.6090281539493,22.2293984801681,22.3266207068055,22.7763893052384,22.3402782170861,22.433796664079,22.7638892685926,22.1203706970921,22.1435188739388,22.3571762839953,22.5287041068077,22.6328707999653,22.4689818399924,23.2562504278289,22.5944447870608,22.6305559498292,22.3766207518401,22.4604170189963,22.9446762954747,22.3245374096764,22.3319448298878,22.3858799956463,22.4428244431814,22.7668984841417,22.7078707593459,22.5111115265776,22.4891207394777,22.74814851858,22.6666670596158],"name":"Temperature","type":"scatter","mode":"lines","yaxis":"y2","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>The two preceeding plots are twin-plots, meaning two graphics have been combined in a single plot area. To plot just one you may be choose one of the dataframes say temperature and plot it on its own. See below</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="6.1-historical-climate-data.html#cb22-1" aria-hidden="true" tabindex="-1"></a>temp_ann<span class="sc">%&gt;%</span><span class="fu">filter</span>(Year<span class="sc">&gt;</span><span class="dv">2000</span>)<span class="sc">%&gt;%</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>()<span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="6.1-historical-climate-data.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">add_lines</span>(<span class="at">x=</span> <span class="sc">~</span>Year, <span class="at">y=</span> <span class="sc">~</span>tmean, <span class="at">color=</span><span class="st">&#39;red&#39;</span>, <span class="at">showlegend=</span><span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="6.1-historical-climate-data.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">add_markers</span>(<span class="at">x=</span> <span class="sc">~</span>Year, <span class="at">y=</span> <span class="sc">~</span>tmean, <span class="at">color=</span><span class="st">&#39;red&#39;</span>, <span class="at">showlegend=</span><span class="cn">FALSE</span>, <span class="at">name=</span><span class="st">&#39;Temperature&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="6.1-historical-climate-data.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">layout</span>(<span class="at">yaxis=</span><span class="fu">list</span>(<span class="at">title=</span><span class="st">&#39;Mean Temerature (°C)&#39;</span>),<span class="at">xaxis=</span><span class="fu">list</span>(<span class="at">tickangle=</span><span class="dv">270</span>))</span></code></pre></div>
<div id="htmlwidget-06b8cdfeb634f7ac560a" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-06b8cdfeb634f7ac560a">{"x":{"visdat":{"74c244fdc8":["function () ","plotlyVisDat"]},"cur_data":"74c244fdc8","attrs":{"74c244fdc8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","color":"red","showlegend":false,"inherit":true},"74c244fdc8.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"markers","color":"red","showlegend":false,"name":"Temperature","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"yaxis":{"domain":[0,1],"automargin":true,"title":"Mean Temerature (°C)"},"xaxis":{"domain":[0,1],"automargin":true,"tickangle":270,"title":"Year","type":"category","categoryorder":"array","categoryarray":["2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020"]},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020"],"y":[22.3571762839953,22.5287041068077,22.6328707999653,22.4689818399924,23.2562504278289,22.5944447870608,22.6305559498292,22.3766207518401,22.4604170189963,22.9446762954747,22.3245374096764,22.3319448298878,22.3858799956463,22.4428244431814,22.7668984841417,22.7078707593459,22.5111115265776,22.4891207394777,22.74814851858,22.6666670596158],"type":"scatter","mode":"lines","showlegend":false,"name":"red","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020"],"y":[22.3571762839953,22.5287041068077,22.6328707999653,22.4689818399924,23.2562504278289,22.5944447870608,22.6305559498292,22.3766207518401,22.4604170189963,22.9446762954747,22.3245374096764,22.3319448298878,22.3858799956463,22.4428244431814,22.7668984841417,22.7078707593459,22.5111115265776,22.4891207394777,22.74814851858,22.6666670596158],"type":"scatter","mode":"markers","showlegend":false,"name":"Temperature","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

</div>
</div>
<!-- </div> -->
<p style="text-align: center;">
<a href="6-working-climate-data.html"><button class="btn btn-default">Previous</button></a>
<a href="7-further-reads.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
